<!DOCTYPE html>
{% set currentLang = lang or site.lang %}
{% set canonicalPath = page.url | stripLangPrefix %}
{% set enReadyPaths = [
  '/',
  '/vpn/recommend/',
  '/vpn/posts/',
  '/about/',
  '/disclaimer/',
  '/privacy/',
  '/contact/',
  '/dmca/',
  '/terms/',
  '/vpn/review-methodology/',
  '/vpn/posts/nordvpn-review/',
  '/vpn/posts/surfshark-review/',
  '/vpn/posts/protonvpn-review/',
  '/vpn/posts/purevpn-review/',
  '/vpn/posts/expressvpn-review/',
  '/vpn/posts/cyberghost-review/',
  '/vpn/posts/pia-review/',
  '/vpn/posts/ivacy-review/',
  '/vpn/posts/mullvad-review/',
  '/vpn/posts/strongvpn-review/',
  '/vpn/posts/atlas-review/'
] %}
{% set hasEn = canonicalPath in enReadyPaths %}
<html lang="{{ currentLang }}">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>{% if title %}{{ title }}{% else %}{{ site.title }}{% endif %}</title>
    {% if description %}
      <meta name="description" content="{{ description }}" />
    {% else %}
      <meta name="description" content="{{ site.description }}" />
    {% endif %}

    {% if noindex %}
      <meta name="robots" content="noindex,nofollow" />
    {% else %}
      <meta name="robots" content="index,follow" />
    {% endif %}

    {% if page.url == '/' %}
      <meta name="baidu-site-verification" content="codeva-fiSpow0Rsf" />
    {% endif %}

    <link rel="canonical" href="{{ page.url | absoluteUrl(site.url) }}" />

    {% if hasEn %}
      <link rel="alternate" hreflang="zh" href="{{ canonicalPath | withLangPrefix('zh') | absoluteUrl(site.url) }}" />
      <link rel="alternate" hreflang="en" href="{{ canonicalPath | withLangPrefix('en') | absoluteUrl(site.url) }}" />
    {% endif %}

    <meta property="og:site_name" content="{{ site.title }}" />
    <meta property="og:type" content="website" />
    <meta property="og:url" content="{{ page.url | absoluteUrl(site.url) }}" />
    <meta property="og:title" content="{% if title %}{{ title }}{% else %}{{ site.title }}{% endif %}" />
    <meta property="og:description" content="{% if description %}{{ description }}{% else %}{{ site.description }}{% endif %}" />
    <meta property="og:image" content="{{ '/assets/images/logo.jpeg' | absoluteUrl(site.url) }}" />

    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="{% if title %}{{ title }}{% else %}{{ site.title }}{% endif %}" />
    <meta name="twitter:description" content="{% if description %}{{ description }}{% else %}{{ site.description }}{% endif %}" />
    <meta name="twitter:image" content="{{ '/assets/images/logo.jpeg' | absoluteUrl(site.url) }}" />

    <link rel="icon" href="/assets/images/logo.jpeg" />
    <link rel="apple-touch-icon" href="/assets/images/logo.jpeg" />

    <script type="application/ld+json">
      {
        "@context": "https://schema.org",
        "@type": "WebSite",
        "name": "{{ site.title }}",
        "url": "{{ '/' | absoluteUrl(site.url) }}"
      }
    </script>

    <script type="application/ld+json">
      {
        "@context": "https://schema.org",
        "@type": "Organization",
        "name": "{{ site.title }}",
        "url": "{{ '/' | absoluteUrl(site.url) }}",
        "logo": "{{ '/assets/images/logo.jpeg' | absoluteUrl(site.url) }}"
      }
    </script>

    	<link rel="stylesheet" href="/assets/css/site.css" />
  </head>
  <body data-canonical-path="{{ canonicalPath }}">
    <header class="page-header" role="banner">
      <div class="project-name">{% if title %}{{ title }}{% else %}{{ site.title }}{% endif %}</div>
      <h2 class="project-tagline">{% if description %}{{ description }}{% else %}{{ site.description }}{% endif %}</h2>

      {% set navHome = '首页' %}
      {% set navPosts = '评测' %}
      {% if currentLang == 'en' %}
        {% set navHome = 'Home' %}
        {% set navPosts = 'Reviews' %}
      {% endif %}

      <nav class="nav">
        <a class="btn" href="{{ '/vpn/recommend/' | withLangPrefix(currentLang) }}">{{ navHome }}</a>
        <a class="btn" href="{{ '/vpn/posts/' | withLangPrefix(currentLang) }}">{{ navPosts }}</a>
        <select id="lang-select" class="btn" style="max-width: 140px;">
          <option value="zh">中文</option>
          <option value="en">English</option>
        </select>
      </nav>
    </header>

    <main id="content" class="main-content" role="main">
      {{ content | safe }}

      <footer class="site-footer" role="contentinfo">
        <div class="site-footer-inner">
          <div class="site-footer-brand">
            <div class="site-footer-logo" aria-hidden="true">
              <img src="/assets/images/logo.jpeg" alt="An1688" />
            </div>
            <div class="site-footer-desc">
              {% if currentLang == 'en' %}
                An1688 publishes VPN recommendations and hands-on reviews focused on privacy protection and connection security.
              {% else %}
                An1688 整理 VPN 选购思路与真实评测，聚焦隐私保护与连接安全。
              {% endif %}
            </div>
          </div>

          <div class="site-footer-cols">
            <div class="site-footer-col">
              <div class="site-footer-title">{% if currentLang == 'en' %}Site{% else %}站点{% endif %}</div>
              <a class="site-footer-link" href="{{ '/about/' | withLangPrefix(currentLang) }}">{% if currentLang == 'en' %}About{% else %}关于{% endif %}</a>
              <a class="site-footer-link" href="{{ '/vpn/review-methodology/' | withLangPrefix(currentLang) }}">{% if currentLang == 'en' %}Methodology{% else %}评测方法{% endif %}</a>
              <a class="site-footer-link" href="{{ '/vpn/posts/' | withLangPrefix(currentLang) }}">{% if currentLang == 'en' %}Reviews{% else %}评测文章{% endif %}</a>
            </div>

            <div class="site-footer-col">
              <div class="site-footer-title">{% if currentLang == 'en' %}Policies{% else %}政策{% endif %}</div>
              <a class="site-footer-link" href="{{ '/privacy/' | withLangPrefix(currentLang) }}">{% if currentLang == 'en' %}Privacy{% else %}隐私政策{% endif %}</a>
              <a class="site-footer-link" href="{{ '/disclaimer/' | withLangPrefix(currentLang) }}">{% if currentLang == 'en' %}Disclaimer{% else %}免责声明{% endif %}</a>
              <a class="site-footer-link" href="{{ '/dmca/' | withLangPrefix(currentLang) }}">DMCA Policy</a>
              <a class="site-footer-link" href="{{ '/terms/' | withLangPrefix(currentLang) }}">{% if currentLang == 'en' %}Terms &amp; Conditions{% else %}条款与条件{% endif %}</a>
            </div>

            <div class="site-footer-col">
              <div class="site-footer-title">{% if currentLang == 'en' %}Contact{% else %}联系{% endif %}</div>
              <a class="site-footer-link" href="{{ '/contact/' | withLangPrefix(currentLang) }}">{% if currentLang == 'en' %}Contact{% else %}联系{% endif %}</a>
              <div class="site-footer-muted">siwey.xin@gmail.com</div>
            </div>

            <div class="site-footer-col">
              <div class="site-footer-title">{% if currentLang == 'en' %}Follow An1688{% else %}关注 An1688{% endif %}</div>
              <div class="site-footer-social">
                <a class="site-footer-social-btn" href="#" rel="nofollow">Facebook</a>
                <a class="site-footer-social-btn" href="#" rel="nofollow">X</a>
                <a class="site-footer-social-btn" href="#" rel="nofollow">YouTube</a>
              </div>
            </div>
          </div>
        </div>

        <div class="site-footer-bottom">
          <div>© 2026 an1688.com</div>
        </div>
      </footer>
    </main>

    <script>
      (function () {
        var supported = ["zh", "en"];
        var canonicalPath = "{{ canonicalPath }}";

        var hasEn = {% if hasEn %}true{% else %}false{% endif %};

        function getPathWithoutLangPrefix(pathname) {
          if (pathname === "/vpn/en" || pathname === "/vpn/en/") return "/vpn/";
          if (pathname.indexOf("/vpn/en/") === 0) return "/vpn/" + pathname.slice(8);
          for (var i = 0; i < supported.length; i++) {
            var lang = supported[i];
            if (lang === "en" && (pathname === "/en/" || pathname.indexOf("/en/") === 0)) {
              var rest = pathname.slice(3);
              return rest || "/";
            }
          }
          return pathname || "/";
        }

        function getLangFromPath(pathname) {
          if (pathname === "/vpn/en" || pathname === "/vpn/en/" || pathname.indexOf("/vpn/en/") === 0) return "en";
          for (var i = 0; i < supported.length; i++) {
            var lang = supported[i];
            if (lang === "en" && (pathname === "/en/" || pathname.indexOf("/en/") === 0)) return lang;
          }
          return "zh";
        }

        function normalizeNavigatorLang(l) {
          if (!l) return null;
          var s = String(l).toLowerCase();
          if (s.indexOf("zh") === 0) return "zh";
          if (s.indexOf("en") === 0) return "en";
          return null;
        }

        function pickBrowserLang() {
          var langs = (navigator.languages && navigator.languages.length) ? navigator.languages : [navigator.language];
          for (var i = 0; i < langs.length; i++) {
            var v = normalizeNavigatorLang(langs[i]);
            if (v) return v;
          }
          return "en";
        }

        function buildUrl(targetLang) {
          var basePath = getPathWithoutLangPrefix(location.pathname);

          if (targetLang === "en" && !hasEn) {
            basePath = "/vpn/recommend/";
          }

          var p = basePath;
          if (targetLang === "en") {
            if (p === "/vpn" || p === "/vpn/") {
              p = "/vpn/en/";
            } else if (p.indexOf("/vpn/") === 0) {
              p = "/vpn/en" + p.slice(4);
            } else {
              p = "/en" + (p === "/" ? "/" : p);
            }
          }
          if (p === "") p = "/";
          return p + location.search + location.hash;
        }

        var select = document.getElementById("lang-select");
        if (!select) return;

        var currentLang = getLangFromPath(location.pathname);
        var saved = null;
        try {
          saved = localStorage.getItem("site_lang");
        } catch (e) {
          saved = null;
        }

        var target = (saved && supported.indexOf(saved) >= 0) ? saved : pickBrowserLang();

        select.value = currentLang;

        if (!saved && target !== currentLang) {
          location.replace(buildUrl(target));
          return;
        }

        select.addEventListener("change", function () {
          var v = select.value;
          if (supported.indexOf(v) < 0) return;
          try {
            localStorage.setItem("site_lang", v);
          } catch (e) {}
          var url = buildUrl(v);
          if (url !== location.pathname + location.search + location.hash) location.href = url;
        });
      })();
    </script>

    <script>
      (function () {
        function isH2(node) {
          return node && node.nodeType === 1 && node.tagName === "H2";
        }

        function isEmptyText(node) {
          return node && node.nodeType === 3 && !String(node.textContent || "").trim();
        }

        function wrapSectionBodies() {
          var main = document.getElementById("content");
          if (!main) return;

          var footer = main.querySelector("footer.site-footer");
          var h2s = [];
          var cursor = main.firstChild;

          while (cursor && cursor !== footer) {
            if (isH2(cursor)) h2s.push(cursor);
            cursor = cursor.nextSibling;
          }

          if (!h2s.length) return;

          for (var i = 0; i < h2s.length; i++) {
            var h2 = h2s[i];
            var next = h2.nextSibling;

            while (isEmptyText(next)) next = next.nextSibling;

            if (next && next.nodeType === 1 && next.classList && next.classList.contains("section-body")) {
              continue;
            }

            var body = document.createElement("div");
            body.className = "section-body";
            if (h2.nextSibling) {
              main.insertBefore(body, h2.nextSibling);
            } else {
              main.appendChild(body);
            }

            var n = body.nextSibling;
            while (n && n !== footer && !isH2(n)) {
              var nn = n.nextSibling;
              body.appendChild(n);
              n = nn;
            }

            if (!body.firstChild) {
              body.parentNode && body.parentNode.removeChild(body);
            }
          }
        }

        if (document.readyState === "loading") {
          document.addEventListener("DOMContentLoaded", wrapSectionBodies);
        } else {
          wrapSectionBodies();
        }
      })();
    </script>
  </body>
</html>
