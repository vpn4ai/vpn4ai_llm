<!DOCTYPE html>
{% set currentLang = lang or site.lang %}
{% set langKey = 'zh' %}
{% set htmlLang = 'zh-CN' %}
{% if currentLang == 'en' %}
  {% set langKey = 'en' %}
  {% set htmlLang = 'en' %}
{% endif %}
{% set canonicalPath = page.url | stripLangPrefix %}
{% set enReadyPaths = [
  '/',
  '/vpn/recommend/',
  '/vpn/kb/',
  '/vpn/kb/open-source-vpn/',
  '/vpn/posts/',
  '/about/',
  '/disclaimer/',
  '/contact/',
  '/vpn/review-methodology/',
  '/vpn/posts/nordvpn-review/',
  '/vpn/posts/surfshark-review/',
  '/vpn/posts/protonvpn-review/',
  '/vpn/posts/purevpn-review/',
  '/vpn/posts/expressvpn-review/',
  '/vpn/posts/cyberghost-review/',
  '/vpn/posts/pia-review/',
  '/vpn/posts/ivacy-review/',
  '/vpn/posts/mullvad-review/',
  '/vpn/posts/strongvpn-review/',
  '/vpn/posts/atlas-review/'
] %}
{% set hasEn = canonicalPath in enReadyPaths %}
{% set isRecommendPage = canonicalPath == '/vpn/recommend/' %}
{% set isPostsListPage = canonicalPath == '/vpn/posts/' %}
{% set isKbListPage = canonicalPath == '/vpn/kb/' %}
{% set isReviewPage = (canonicalPath | slice(0, 11)) == '/vpn/posts/' and (canonicalPath | slice(-8)) == '-review/' %}
{% set isKbArticlePage = (canonicalPath | slice(0, 8)) == '/vpn/kb/' and canonicalPath != '/vpn/kb/' %}
<html lang="{{ htmlLang }}">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="theme-color" content="#155799" />

    <title>{% if title %}{{ title }}{% else %}{{ site.title }}{% endif %}</title>
    {% if description %}
      <meta name="description" content="{{ description }}" />
    {% else %}
      <meta name="description" content="{{ site.description }}" />
    {% endif %}

    {% if noindex %}
      <meta name="robots" content="noindex,nofollow" />
    {% else %}
      <meta name="robots" content="index,follow" />
    {% endif %}

    {% if page.url == '/' %}
      <meta name="baidu-site-verification" content="codeva-fiSpow0Rsf" />
    {% endif %}

    <link rel="canonical" href="{{ page.url | absoluteUrl(site.url) }}" />

    {% if hasEn %}
      <link rel="alternate" hreflang="zh" href="{{ canonicalPath | withLangPrefix('zh') | absoluteUrl(site.url) }}" />
      <link rel="alternate" hreflang="en" href="{{ canonicalPath | withLangPrefix('en') | absoluteUrl(site.url) }}" />
      <link rel="alternate" hreflang="x-default" href="{{ canonicalPath | withLangPrefix('zh') | absoluteUrl(site.url) }}" />
    {% endif %}

    <meta property="og:site_name" content="{{ site.title }}" />
    <meta property="og:type" content="website" />
    <meta property="og:url" content="{{ page.url | absoluteUrl(site.url) }}" />
    <meta property="og:title" content="{% if title %}{{ title }}{% else %}{{ site.title }}{% endif %}" />
    <meta property="og:description" content="{% if description %}{{ description }}{% else %}{{ site.description }}{% endif %}" />
    <meta property="og:image" content="{{ '/assets/images/logo.png' | absoluteUrl(site.url) }}" />
    <meta property="og:image:alt" content="{{ site.title }}" />
    <meta property="og:locale" content="{% if langKey == 'en' %}en_US{% else %}zh_CN{% endif %}" />
    {% if hasEn %}
      <meta property="og:locale:alternate" content="{% if langKey == 'en' %}zh_CN{% else %}en_US{% endif %}" />
    {% endif %}

    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="{% if title %}{{ title }}{% else %}{{ site.title }}{% endif %}" />
    <meta name="twitter:description" content="{% if description %}{{ description }}{% else %}{{ site.description }}{% endif %}" />
    <meta name="twitter:image" content="{{ '/assets/images/logo.png' | absoluteUrl(site.url) }}" />

    <link rel="icon" href="/assets/images/logo.png" />
    <link rel="apple-touch-icon" href="/assets/images/logo.png" />

    <script type="application/ld+json">
      {
        "@context": "https://schema.org",
        "@type": "WebSite",
        "name": "{{ site.title }}",
        "url": "{{ '/' | absoluteUrl(site.url) }}"
      }
    </script>

    <script type="application/ld+json">
      {
        "@context": "https://schema.org",
        "@type": "Organization",
        "name": "{{ site.title }}",
        "url": "{{ '/' | absoluteUrl(site.url) }}",
        "logo": "{{ '/assets/images/logo.png' | absoluteUrl(site.url) }}"
      }
    </script>

    {% set schemaPageType = 'WebPage' %}
    {% if isRecommendPage or isPostsListPage or isKbListPage %}
      {% set schemaPageType = 'CollectionPage' %}
    {% endif %}
    {% if isReviewPage or isKbArticlePage %}
      {% set schemaPageType = 'Article' %}
    {% endif %}

    <script type="application/ld+json">
      {
        "@context": "https://schema.org",
        "@type": "{{ schemaPageType }}",
        "@id": "{{ page.url | absoluteUrl(site.url) }}#{{ schemaPageType | lower }}",
        "url": "{{ page.url | absoluteUrl(site.url) }}",
        "name": "{% if title %}{{ title }}{% else %}{{ site.title }}{% endif %}",
        "headline": "{% if title %}{{ title }}{% else %}{{ site.title }}{% endif %}",
        "description": "{% if description %}{{ description }}{% else %}{{ site.description }}{% endif %}",
        "inLanguage": "{{ htmlLang }}",
        "isPartOf": {
          "@type": "WebSite",
          "name": "{{ site.title }}",
          "url": "{{ '/' | absoluteUrl(site.url) }}"
        },
        "publisher": {
          "@type": "Organization",
          "name": "{{ site.title }}",
          "url": "{{ '/' | absoluteUrl(site.url) }}",
          "logo": {
            "@type": "ImageObject",
            "url": "{{ '/assets/images/logo.png' | absoluteUrl(site.url) }}"
          }
        }
        {% if schemaPageType == 'Article' %}
        ,"mainEntityOfPage": {
          "@type": "WebPage",
          "@id": "{{ page.url | absoluteUrl(site.url) }}"
        }
        {% if page.date %}
        ,"datePublished": "{{ page.date | dateIso }}"
        ,"dateModified": "{{ (updated or page.date) | dateIso }}"
        {% endif %}
        {% endif %}
      }
    </script>

    <link rel="stylesheet" href="/assets/css/site.css" />
  </head>
  <body>
    <header class="page-header" role="banner">
      <div class="project-name">{% if title %}{{ title }}{% else %}{{ site.title }}{% endif %}</div>

      {% set navHome = '首页' %}
      {% set navPosts = '评测文章' %}
      {% set navKb = '知识库' %}
      {% if currentLang == 'en' %}
        {% set navHome = 'Home' %}
        {% set navPosts = 'Review List' %}
        {% set navKb = 'Knowledge Base' %}
      {% endif %}

      <nav class="nav">
        <a class="btn" href="{{ '/vpn/recommend/' | withLangPrefix(langKey) }}">{{ navHome }}</a>
        <a class="btn" href="{{ '/vpn/kb/' | withLangPrefix(langKey) }}">{{ navKb }}</a>
        <a class="btn" href="{{ '/vpn/posts/' | withLangPrefix(langKey) }}">{{ navPosts }}</a>
        <select id="lang-select" class="btn" style="max-width: 140px;">
          <option value="zh">中文</option>
          <option value="en">English</option>
        </select>
      </nav>
    </header>

    <main id="content" class="main-content" role="main">
      {{ content | safe }}

      {% if isReviewPage %}
        {% set moreTitle = '继续阅读' %}
        {% set moreDesc = '如果你要更快做决定，可以从“总推荐”开始，然后对比评测方法与知识库要点。' %}
        {% set moreRecommend = '回到推荐榜单（按场景）' %}
        {% set morePosts = '查看评测文章列表' %}
        {% set moreMethod = '查看评测方法' %}
        {% set moreKb = '进入知识库' %}
        {% if currentLang == 'en' %}
          {% set moreTitle = 'Next steps' %}
          {% set moreDesc = 'For faster decision-making, start from the recommendation page, then read methodology and key guides.' %}
          {% set moreRecommend = 'Back to recommendations' %}
          {% set morePosts = 'All review articles' %}
          {% set moreMethod = 'Review methodology' %}
          {% set moreKb = 'Knowledge base' %}
        {% endif %}

        <hr />
        <div class="section-body">
          <div style="font-weight: 900;">{{ moreTitle }}</div>
          <div style="margin-top: 6px; color: rgba(0,0,0,0.75);">{{ moreDesc }}</div>
          <div class="cta-group" style="margin-bottom: 0;">
            <a class="cta-primary" href="{{ '/vpn/recommend/' | withLangPrefix(langKey) }}">{{ moreRecommend }}</a>
            <a class="cta-secondary" href="{{ '/vpn/posts/' | withLangPrefix(langKey) }}">{{ morePosts }}</a>
            <a class="cta-secondary" href="{{ '/vpn/review-methodology/' | withLangPrefix(langKey) }}">{{ moreMethod }}</a>
            <a class="cta-secondary" href="{{ '/vpn/kb/' | withLangPrefix(langKey) }}">{{ moreKb }}</a>
          </div>
        </div>
      {% endif %}
    </main>

    {% set footerTitle = '关注 an1688' %}
    {% set footerTerms = 'Terms' %}
    {% set footerPrivacy = 'privacy-policy' %}
    {% set footerDmca = 'DMCA' %}
    {% set footerAffiliate = 'Affiliate Disclosure' %}
    {% set footerVpnRecommend = '首页' %}
    {% set footerReviews = '评测文章' %}
    {% set footerBrandDesc = 'an1688.com 专注跨境网络与数字工具选购：提供 VPN 评测、场景化推荐与避坑指南，帮助你更稳、更省心地选择合适方案。' %}
    {% if currentLang == 'en' %}
      {% set footerTitle = 'Follow an1688' %}
      {% set footerTerms = 'Terms' %}
      {% set footerPrivacy = 'privacy-policy' %}
      {% set footerDmca = 'DMCA' %}
      {% set footerAffiliate = 'Affiliate Disclosure' %}
      {% set footerVpnRecommend = 'Home' %}
      {% set footerReviews = 'Reviews' %}
      {% set footerBrandDesc = 'An1688.com is a reader-supported guide for cross-border connectivity and digital tools. We publish scenario-based VPN reviews and practical buying tips to help you choose with confidence.' %}
    {% endif %}

    <footer class="site-footer" role="contentinfo">
      <div class="site-footer-inner">
        <div class="site-footer-col">
          <div class="site-footer-brand">
            <img class="site-footer-logo" src="/assets/images/logo.png" alt="an1688" loading="lazy" />
            <div class="site-footer-brand-text">
              <div class="site-footer-brand-desc">{{ footerBrandDesc }}</div>
            </div>
          </div>
        </div>

        <div class="site-footer-col">
          <div class="site-footer-links">
            <a href="{{ '/vpn/recommend/' | withLangPrefix(langKey) }}">{{ footerVpnRecommend }}</a>
            <a href="{{ '/vpn/posts/' | withLangPrefix(langKey) }}">{{ footerReviews }}</a>
          </div>
        </div>

        <div class="site-footer-col">
          <div class="site-footer-links">
            <a href="/terms/">{{ footerTerms }}</a>
            <a href="/privacy-policy/">{{ footerPrivacy }}</a>
            <a href="/dmca/">{{ footerDmca }}</a>
            <a href="/affiliate-disclosure/">{{ footerAffiliate }}</a>
          </div>
        </div>
      </div>
      <div class="site-footer-bottom">
        <div>© 2026 an1688</div>
        <div class="site-footer-bottom-right">
          <span class="site-footer-bottom-title">{{ footerTitle }}</span>
          <a href="https://www.an1688.com" target="_blank" rel="nofollow">an1688.com</a>
        </div>
      </div>
    </footer>

    <script>
      (function () {
        var supported = ["zh", "en"];
        var canonicalPath = "{{ canonicalPath }}";

        var hasEn = {% if hasEn %}true{% else %}false{% endif %};

        function getPathWithoutLangPrefix(pathname) {
          if (pathname === "/vpn/en" || pathname === "/vpn/en/") return "/vpn/";
          if (pathname.indexOf("/vpn/en/") === 0) return "/vpn/" + pathname.slice(8);
          for (var i = 0; i < supported.length; i++) {
            var lang = supported[i];
            if (lang === "en" && (pathname === "/en/" || pathname.indexOf("/en/") === 0)) {
              var rest = pathname.slice(3);
              return rest || "/";
            }
          }
          return pathname || "/";
        }

        function getLangFromPath(pathname) {
          if (pathname === "/vpn/en" || pathname === "/vpn/en/" || pathname.indexOf("/vpn/en/") === 0) return "en";
          for (var i = 0; i < supported.length; i++) {
            var lang = supported[i];
            if (lang === "en" && (pathname === "/en/" || pathname.indexOf("/en/") === 0)) return lang;
          }
          return "zh";
        }

        function normalizeNavigatorLang(l) {
          if (!l) return null;
          var s = String(l).toLowerCase();
          if (s.indexOf("zh") === 0) return "zh";
          if (s.indexOf("en") === 0) return "en";
          return null;
        }

        function pickBrowserLang() {
          var langs = (navigator.languages && navigator.languages.length) ? navigator.languages : [navigator.language];
          for (var i = 0; i < langs.length; i++) {
            var v = normalizeNavigatorLang(langs[i]);
            if (v) return v;
          }
          return "en";
        }

        function buildUrl(targetLang) {
          var basePath = getPathWithoutLangPrefix(location.pathname);

          if (basePath === "/dmca/" || basePath === "/dmca") {
            return "/dmca/" + location.search + location.hash;
          }

          if (basePath === "/terms/" || basePath === "/terms") {
            return "/terms/" + location.search + location.hash;
          }

          if (basePath === "/privacy-policy/" || basePath === "/privacy-policy") {
            return "/privacy-policy/" + location.search + location.hash;
          }

          if (basePath === "/affiliate-disclosure/" || basePath === "/affiliate-disclosure") {
            return "/affiliate-disclosure/" + location.search + location.hash;
          }

          if (targetLang === "en" && !hasEn) {
            basePath = "/vpn/recommend/";
          }

          var p = basePath;
          if (targetLang === "en") {
            if (p === "/vpn" || p === "/vpn/") {
              p = "/vpn/en/";
            } else if (p.indexOf("/vpn/") === 0) {
              p = "/vpn/en" + p.slice(4);
            } else {
              p = "/en" + (p === "/" ? "/" : p);
            }
          }
          if (p === "") p = "/";
          return p + location.search + location.hash;
        }

        var select = document.getElementById("lang-select");
        if (!select) return;

        var currentLang = getLangFromPath(location.pathname);
        var saved = null;
        try {
          saved = localStorage.getItem("site_lang");
        } catch (e) {
          saved = null;
        }

        var target = (saved && supported.indexOf(saved) >= 0) ? saved : pickBrowserLang();

        select.value = currentLang;

        if (!saved && target !== currentLang) {
          location.replace(buildUrl(target));
          return;
        }

        select.addEventListener("change", function () {
          var v = select.value;
          if (supported.indexOf(v) < 0) return;
          try {
            localStorage.setItem("site_lang", v);
          } catch (e) {}
          var url = buildUrl(v);
          if (url !== location.pathname + location.search + location.hash) location.href = url;
        });
      })();
    </script>

    <script>
      (function () {
        function isH2(node) {
          return node && node.nodeType === 1 && node.tagName === "H2";
        }

        function isEmptyText(node) {
          return node && node.nodeType === 3 && !String(node.textContent || "").trim();
        }

        function wrapSectionBodies() {
          var main = document.getElementById("content");
          if (!main) return;

          var footer = main.querySelector("footer.site-footer");
          var h2s = [];
          var cursor = main.firstChild;

          while (cursor && cursor !== footer) {
            if (isH2(cursor)) h2s.push(cursor);
            cursor = cursor.nextSibling;
          }

          if (!h2s.length) return;

          for (var i = 0; i < h2s.length; i++) {
            var h2 = h2s[i];
            var next = h2.nextSibling;

            while (isEmptyText(next)) next = next.nextSibling;

            if (next && next.nodeType === 1 && next.classList && next.classList.contains("section-body")) {
              continue;
            }

            var body = document.createElement("div");
            body.className = "section-body";
            if (h2.nextSibling) {
              main.insertBefore(body, h2.nextSibling);
            } else {
              main.appendChild(body);
            }

            var n = body.nextSibling;
            while (n && n !== footer && !isH2(n)) {
              var nn = n.nextSibling;
              body.appendChild(n);
              n = nn;
            }

            if (!body.firstChild) {
              body.parentNode && body.parentNode.removeChild(body);
            }
          }
        }

        if (document.readyState === "loading") {
          document.addEventListener("DOMContentLoaded", wrapSectionBodies);
        } else {
          wrapSectionBodies();
        }
      })();
    </script>
  </body>
</html>
